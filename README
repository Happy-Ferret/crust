# Dependencies

 * [rust-lang/rust](https://github.com/rust-lang/rust), revision 1.0.0-alpha.2-1771-gd528aa9

 * GHC 7
 * [parsec](https://hackage.haskell.org/package/parsec)
 * [regex-tdfa](https://hackage.haskell.org/package/regex-tdfa)
 * [syb](https://hackage.haskell.org/package/syb)

 * OCaml compiler
 * ocamlbuild

 * [CBMC](http://www.cprover.org/cbmc/)

Crust runs only on 64-bit Linux.


# Environment

After compiling the version of Rust indicated above:

 * Add `/path/to/rust/x86_64-.../stage2/bin` to `$PATH`
 * Add `/path/to/rust/x86_64-.../stage2/lib` to `$LD_LIBRARY_PATH`

Also, add a symlink to the Rust source code in `stdlib_tests/`:

    ln -s /path/to/rust/src /path/to/crust/stdlib_tests/src


# Compiling

Run `make` at the top level.


# Running tests

    mkdir stdlib_tests_build
    cd stdlib_tests_build
    mkdir lib ir driver test
    # Generate test drivers:
    ../stdlib_tests/bin/driver.mk test/eval_vec.c
    # Run tests:
    ../stdlib_tests/bin/run_tests.sh test/eval_vec.c
    # Report failed tests:
    ../stdlib_tests/bin/collect_failing.sh

Replace the name `eval_vec` with the basename of one of the files from
`crust/stdlib_tests/filters` to change which tests are run.


# Adding new tests

TODO: not quite working yet - you can add new filters
(`stdlib_tests/filters/cell.filter`) and new code
(`crust/test/custom/cell.rs`), but you need to manually add
`extern crate cell` to `build/test/z_cell.rs` and `.../bin/driver.mk
lib/libcell.rlib`)
